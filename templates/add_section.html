{% include 'header.html' %}

<div class="content">
    <div class="single-line add-form ">
        <div class="brd c-left">
            <label for="titlesection" style="margin-left: 10px">Section Name:</label>
            <input id="titlesection" type="text" placeholder="Add the title of the section here" required>
            <br> <br>
            <label for="textboxdetails" style="margin-left: 10px">Section Details:</label>
            <span id="textboxdetails" role="textbox" contenteditable>
            </span>
            <br> <br>
            <input id="submit" type="submit" style="margin-left: 10px;width: 150px" value="Save">
        </div>
    </div>
    <div class="single-line mt20">
        <div class="">
            <div class="brd c-left list-holder village-list">
                <b>List of Sections</b>
                <br>
                <table>
                    <tr>
                        <th>Section Title</th>
                        <th>Section Details</th>
                    </tr>
                    {% for d in data %}
                        <tr>
                            <td>{{ d.title }}</td>
                            <td>{{ d.details }}</td>
                            <td>
                                <button class="delete_button" onclick="confirm('Are you sure?')">
                                    <a href={% url 'delete_section' key=d.id %}>
                                        <i class="fas fa-trash"></i>
                                        Delete
                                    </a>
                                </button>
                            </td>
                        </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
    </div>
</div>

{% block javascript %}
    <script>
        let titlesection = null;
        let textboxdetails = null;
        $("#titlesection").change(function () {
            titlesection = $(this).val();
        });
        $("#textboxdetails").change(function () {
            textboxdetails = $(this).val();
        });

        $("#submit").click(function () {
            if (titlesection == null)
                alert('Insert a title')
            else {
                $.ajax({
                    url: {% url 'save_section' %},
                    method: 'POST',
                    data: {
                        'title': titlesection,
                        'details': textboxdetails,
                        csrfmiddlewaretoken: window.CSRF_TOKEN,
                    },
                    success: function () {
                        alert('Saved');
                        window.location.href = {% url 'survey' %}
                    },
                    error: function (jqXHR, exception) {
                        alert(jqXHR.status + " " + exception)
                    }
                });
            }
        })
    </script>
    <script type="text/javascript"> window.CSRF_TOKEN = "{{ csrf_token }}"; </script>
{% endblock %}