{% include 'header.html' %}
{% load static %}

<head>
    <link rel="stylesheet" href={% static 'assets/css/vendor.css' %}/>
    <link rel="stylesheet" href={% static 'assets/css/formbuilder.css' %}/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<div class="content">
    <div class="single-line add-form ">
        <input id="submit" type="submit" style="margin-left: 200px" value="Save">
        <div class="brd c-left">
            <div id='formbuilder'></div>
            <script>
                $(function () {
                    fb = new Formbuilder({
                        selector: '#formbuilder',
                        bootstrapData: [
                            {{ query }}
                        ]
                    });
                    let datas = null;
                    fb.on('save', function (payload) {
                        console.log(payload);
                        datas = payload;
                    });

                    $("#submit").click(function () {
                        $.ajax({
                            url: {% url 'save_survey' %},
                            method: 'POST',
                            data: {
                                'data': datas,
                                'token': {{ token }},
                                csrfmiddlewaretoken: window.CSRF_TOKEN,
                            },
                            success: function () {
                                alert('Saved');
                            },
                            error: function (jqXHR, exception) {
                                alert(jqXHR.status + " " + exception)
                            }
                        });
                    })
                });
            </script>
        </div>
    </div>
</div>

{% block javascript %}
    <script src={% static 'assets/js/vendor.js' %}></script>
    <script src={% static 'assets/js/formbuilder.js' %}></script>
    <script type="text/javascript"> window.CSRF_TOKEN = "{{ csrf_token }}"; </script>

{% endblock %}