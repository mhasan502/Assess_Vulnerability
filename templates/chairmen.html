{% include 'header.html' %}

<div class="content">
    <div class="single-line add-form">
        <div class="brd c-left">
            <label>Add Chairman Account</label>
            <br>
            <div class="select-holder">
                <select id="district" name="district" required></select>
                <select id="upazila" name="upazila" required></select>
                <select id="union" name="union" required></select>
            </div>
            <br>
            <div class="chairmen-input">
                <div class="ileft">
                    <label for="email">Email address</label>
                    <input id="email" type="text" placeholder="Enter chairman email" required/>
                </div>
                <div class="icright">
                    <label for="password">Password</label>
                    <input id="password" type="text" placeholder="Enter a password" value={{ password }} required/>
                </div>
            </div>
            <div class="">
                <input id="name" type="text" placeholder="Enter chairman name" required/>
                <input id="submit" type="submit" name="add-chairman" value="Add"/>
            </div>
        </div>
    </div>


    {% block javascript %}
        <script>
            let upazila = null;
            let union = null;

            $("#union").change(function () {
                union = $(this).val();
            });

            $("#submit").click(function () {
                let name = $("#name").val();
                let password = $("#password").val();
                let email = $("#email").val();
                $.ajax({
                    url: 'api/save_chairman/',
                    data: {
                        'name': name,
                        'email': email,
                        'password': password,
                        'union': union,
                    },
                    dataType: 'json',
                    success: function (data) {
                        if (data.chairman_saved)
                            alert("Chairman Added");
                    },
                    error: function (e) {
                        alert("An error ocurred");
                    }
                });
            })
        </script>
    {% endblock %}


    <div class="single-line mt20">
        <div class="">
            <div class="brd c-left list-holder village-list">
                <p>List of Chairmen</p> <br>

                <table>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Password</th>
                        <th>Union</th>
                        <th>Upazila</th>
                        <th>District</th>
                        <th>Division</th>
                        <th></th>
                    </tr>
                    {% for d in data %}
                        <tr>
                            <td> {{ d.name }} </td>
                            <td> {{ d.email }} </td>
                            <td> {{ d.password }}</td>
                            <td> {{ d.union }} </td>
                            <td> {{ d.union.upazila }} </td>
                            <td> {{ d.union.upazila.district }} </td>
                            <td> {{ d.union.upazila.district.division }} </td>
                            <td>
                                <button class="delete_button" onclick="confirm('Are you sure?')">
                                    <a href={% url 'delete_chairman' key=d.id %}>Delete</a>
                                </button>
                            </td>
                        </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    let dropdown1 = $('#district');
    dropdown1.empty();
    dropdown1.append('<option selected="true" disabled>Choose districts</option>');
    dropdown1.prop('selectedIndex', 0);

    let url = '/api/district';
    // Populate dropdown with list of provinces
    $.getJSON(url, function (data) {
        $.each(data, function (key, entry) {
            dropdown1.append($('<option></option>').attr('value', entry.id).text(entry.bn_name));
        })
    });
    dropdown1.change(function () {
        let selected = $(this).children("option:selected").val();
        let dropdown2 = $('#upazila');
        dropdown2.empty();
        dropdown2.removeAttr('disabled');
        dropdown2.append('<option selected="true" disabled>Choose upazila</option>');
        dropdown2.prop('selectedIndex', 0);

        let url = '/api/upazila/' + selected;
        // Populate dropdown with list of provinces
        $.getJSON(url, function (data) {
            $.each(data, function (key, entry) {
                dropdown2.append($('<option></option>').attr('value', entry.id).text(entry.bn_name));
            })
        });

        dropdown2.change(function () {
            let selected2 = $(this).children("option:selected").val();
            let dropdown3 = $('#union');
            dropdown3.empty();
            dropdown3.removeAttr('disabled');
            dropdown3.append('<option selected="true" disabled>Choose union</option>');
            dropdown3.prop('selectedIndex', 0);

            let url = '/api/union/' + selected2;
            // Populate dropdown with list of provinces
            $.getJSON(url, function (data) {
                let ic = 0;
                $.each(data, function (key, entry) {
                    dropdown3.append($('<option></option>').attr('value', entry.id).text(entry.bn_name));
                    ic++;
                });
                if (ic < 1)
                    dropdown3.append('<option selected="true" disabled>No union available</option>');
            });
        });
    });
</script>

<script>
    let dropdown2 = $('#upazila');
    dropdown2.empty();
    dropdown2.attr('disabled', 'disabled');
    dropdown2.append('<option selected="true" disabled>Choose upazila</option>');
    dropdown2.prop('selectedIndex', 0);
</script>

<script>
    let dropdown3 = $('#union');
    dropdown3.empty();
    dropdown3.attr('disabled', 'disabled')
    dropdown3.append('<option selected="true" disabled>Choose union</option>');
    dropdown3.prop('selectedIndex', 0);
</script>
