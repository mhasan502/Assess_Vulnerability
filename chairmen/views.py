import string
from django.contrib.auth.base_user import BaseUserManager
from django.contrib.auth.models import User
from django.http import JsonResponse
from django.shortcuts import render, redirect
from chairmen.models import Chairmen


def ChairmenView(request):
    password = BaseUserManager().make_random_password(8, string.ascii_lowercase)
    query = Chairmen.objects.all()
    return render(request, 'chairmen.html', {'password': password, 'data': query})


def SaveChairman(request):
    name_data = request.GET.get('name')
    email_data = request.GET.get('email')
    password_data = request.GET.get('password')
    union_data = request.GET.get('union')
    chairman = Chairmen.objects.create(
        name=name_data,
        email=email_data,
        password=password_data,
        union_id=union_data
    )
    chairman.save()

    user = User.objects.create(
        username=email_data,
        email=email_data,
        is_staff=False,
        is_superuser=False
    )
    user.set_password(password_data)
    user.save()
    data = {
        'chairman_saved': True
    }
    return JsonResponse(data)


def DeleteChairman(request, key):
    query = Chairmen.objects.get(id=key)
    user = User.objects.get(email=query.email, password=query.password)
    user.delete()
    query.delete()
    return redirect('chairmen')
